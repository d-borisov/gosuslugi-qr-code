<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>GosUslugi QR code</title>
    <link rel="stylesheet" href="https://unpkg.com/sweetalert2@11.1.9/dist/sweetalert2.min.css">
    <script src="https://unpkg.com/html5-qrcode@2.1.2/html5-qrcode.min.js"></script>
    <script src="https://unpkg.com/sweetalert2@11.1.9/dist/sweetalert2.min.js"></script>
</head>
<body>
    <div>
        <span>GosUslugi QR code scanner</span>
    </div>
    <div>
        <div style="width: 500px" id="reader"></div>
        <script>
            var html5QrcodeScanner = new Html5QrcodeScanner("reader", { fps: 10, qrbox: 250 });

            function onScanSuccess(decodedText, decodedResult) {
                if (isGosUslugiUrl(decodedText)) {
                    html5QrcodeScanner.clear();
                    window.location.href = decodedText;
                    return;
                }

                Swal.fire({
                    title: "Ошибка!",
                    text: `QR не ведет на сайт ГосУслуг. ${decodedText}`,
                    icon: "error",
                    confirmButtonText: "Продолжить"
                });
            }

            function isGosUslugiUrl(text) {
                try {
                    var url = new URL(text);
                    return url.hostname === "www.gosuslugi.ru";
                } catch (e) {
                    return false;
                }
            }

            html5QrcodeScanner.render(onScanSuccess);
        </script>
    </div>
    <div>
        <span id="results">Result:</span>
    </div>
</body>
</html>